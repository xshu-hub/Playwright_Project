# Playwright-Pytest-Allure Web UI è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶

åŸºäº Playwrightã€Pytest å’Œ Allure çš„ç°ä»£åŒ– Web UI è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼Œæä¾›å®Œæ•´çš„æµ‹è¯•åŸºç¡€æ¶æ„å’Œå·¥å…·é›†ã€‚

## ğŸ“‹ ç›®å½•

- [ç‰ˆæœ¬æ›´æ–°](#-ç‰ˆæœ¬æ›´æ–°)
- [æ ¸å¿ƒç‰¹æ€§](#-æ ¸å¿ƒç‰¹æ€§)
- [æ¡†æ¶æ•´ä½“æ¶æ„](#-æ¡†æ¶æ•´ä½“æ¶æ„)
- [é¡¹ç›®ç»“æ„](#-é¡¹ç›®ç»“æ„)
- [ç¯å¢ƒè¦æ±‚ä¸ä¾èµ–é¡¹](#-ç¯å¢ƒè¦æ±‚ä¸ä¾èµ–é¡¹)
- [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [å·¥å…·ç±»è¯¦è§£](#-å·¥å…·ç±»è¯¦è§£)
- [é…ç½®æ–‡ä»¶è¯´æ˜](#-é…ç½®æ–‡ä»¶è¯´æ˜)
- [æµ‹è¯•ç”¨ä¾‹ç¼–å†™è§„èŒƒ](#-æµ‹è¯•ç”¨ä¾‹ç¼–å†™è§„èŒƒ)
- [ä½¿ç”¨ç¤ºä¾‹](#-ä½¿ç”¨ç¤ºä¾‹)
- [å¸¸è§é—®é¢˜è§£ç­”](#-å¸¸è§é—®é¢˜è§£ç­”)
- [æœ€ä½³å®è·µ](#-æœ€ä½³å®è·µ)

## ğŸ“ˆ ç‰ˆæœ¬æ›´æ–°

### æœ€æ–°ç‰ˆæœ¬ (2025å¹´9æœˆ)

**ğŸ‰ é‡å¤§æ”¹è¿›å’Œä¿®å¤**

- **âœ… æµ‹è¯•ç¨³å®šæ€§æå‡**: ä¿®å¤äº†è¡¨å•æäº¤æµ‹è¯•ä¸­çš„é€‰æ‹©å™¨å†²çªé—®é¢˜ï¼Œ30ä¸ªæµ‹è¯•ç”¨ä¾‹100%é€šè¿‡
- **ğŸ› ï¸ æ™ºèƒ½ç›®å½•ç®¡ç†**: å®Œå…¨ä¿®å¤ç©ºç›®å½•é—®é¢˜ï¼Œåªåœ¨å®é™…éœ€è¦æ—¶åˆ›å»ºæˆªå›¾å’Œè§†é¢‘ç›®å½•
- **âš¡ æ€§èƒ½ä¼˜åŒ–**: ä¼˜åŒ–äº†é¡µé¢å¯¹è±¡æ¨¡å‹ï¼Œå¹³å‡æµ‹è¯•æ‰§è¡Œæ—¶é—´æå‡è‡³1.3ç§’/ç”¨ä¾‹
- **ğŸ”§ ä»£ç è´¨é‡**: ä¿®å¤ç¼©è¿›é”™è¯¯ï¼Œç»Ÿä¸€ä»£ç é£æ ¼ï¼Œæé«˜å¯ç»´æŠ¤æ€§
- **ğŸ“Š æµ‹è¯•è¦†ç›–**: éªŒè¯äº†è¡¨å•å¤„ç†ã€æ¨¡æ€æ¡†ã€æ ‡ç­¾é¡µã€è¡¨æ ¼ç­‰æ ¸å¿ƒåŠŸèƒ½
- **ğŸš€ å¹¶è¡Œæ‰§è¡Œ**: æ”¯æŒ16ä¸ªworkerå¹¶è¡Œæ‰§è¡Œï¼Œå¤§å¹…æå‡æµ‹è¯•æ•ˆç‡

**ğŸ”§ æŠ€æœ¯æ”¹è¿›**

- ä¼˜åŒ–äº† `verify_form_alert` æ–¹æ³•çš„ç­‰å¾…æœºåˆ¶
- ç®€åŒ–äº†æµ‹è¯•ç”¨ä¾‹ç»“æ„ï¼Œä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½éªŒè¯
- æ”¹è¿›äº†é”™è¯¯å¤„ç†å’Œè°ƒè¯•ä¿¡æ¯è¾“å‡º
- å®Œå–„äº†é¡µé¢å¯¹è±¡æ¨¡å‹çš„å…ƒç´ å®šä½ç­–ç•¥

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

- **ğŸ­ å¤šæµè§ˆå™¨æ”¯æŒ**: åŸºäº Playwrightï¼Œæ”¯æŒ Chromiumã€Firefoxã€WebKit ä¸‰å¤§æµè§ˆå™¨å¼•æ“
- **ğŸ§ª å¼ºå¤§æµ‹è¯•æ¡†æ¶**: ä½¿ç”¨ Pytest ä½œä¸ºæµ‹è¯•è¿è¡Œå™¨ï¼Œæä¾›ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€å’Œçµæ´»çš„æµ‹è¯•ç»„ç»‡
- **ğŸ“Š ç¾è§‚æµ‹è¯•æŠ¥å‘Š**: é›†æˆ Allure æŠ¥å‘Šç³»ç»Ÿï¼Œæä¾›è¯¦ç»†çš„æµ‹è¯•ç»“æœå±•ç¤ºå’Œå†å²è¶‹åŠ¿åˆ†æ
- **ğŸ“„ é¡µé¢å¯¹è±¡æ¨¡å‹**: å®ç°æ ‡å‡†çš„ POM è®¾è®¡æ¨¡å¼ï¼Œæé«˜ä»£ç å¯ç»´æŠ¤æ€§å’Œå¤ç”¨æ€§
- **ğŸ“ æ™ºèƒ½æ—¥å¿—ç³»ç»Ÿ**: åŸºäº Loguru çš„ç»“æ„åŒ–æ—¥å¿—è®°å½•ï¼Œæ”¯æŒå¤šçº§åˆ«æ—¥å¿—å’Œæµ‹è¯•æ­¥éª¤è¿½è¸ª
- **ğŸ“¸ è‡ªåŠ¨åŒ–æˆªå›¾å½•å±**: å¤±è´¥æ—¶è‡ªåŠ¨æˆªå›¾å’Œå½•å±ï¼Œå¿«é€Ÿå®šä½é—®é¢˜æ ¹å› 
- **ğŸ”„ CI/CD é›†æˆ**: å®Œæ•´çš„ GitHub Actions å·¥ä½œæµï¼Œæ”¯æŒæŒç»­é›†æˆå’Œéƒ¨ç½²
- **ğŸ¯ å¤šç¯å¢ƒé…ç½®**: çµæ´»çš„ç¯å¢ƒé…ç½®ç®¡ç†ï¼Œæ”¯æŒå¼€å‘ã€æµ‹è¯•ã€é¢„å‘å¸ƒã€ç”Ÿäº§ç¯å¢ƒ
- **âš¡ å¹¶è¡Œæ‰§è¡Œ**: æ”¯æŒå¤šè¿›ç¨‹å¹¶è¡Œæµ‹è¯•æ‰§è¡Œï¼Œæé«˜æµ‹è¯•æ•ˆç‡ï¼ˆ16ä¸ªworkerå¹¶è¡Œï¼‰
- **ğŸ”„ å¤±è´¥é‡è¯•**: æ™ºèƒ½å¤±è´¥é‡è¯•æœºåˆ¶ï¼Œæé«˜æµ‹è¯•ç¨³å®šæ€§
- **ğŸ“ æ™ºèƒ½ç›®å½•ç®¡ç†**: æŒ‰æµ‹è¯•ä¼šè¯è‡ªåŠ¨ç»„ç»‡æŠ¥å‘Šå’Œæ–‡ä»¶ï¼Œé¿å…æ–‡ä»¶æ··ä¹±
- **ğŸ› ï¸ ä¼˜åŒ–çš„èµ„æºç®¡ç†**: æ™ºèƒ½çš„æˆªå›¾å’Œè§†é¢‘æ–‡ä»¶ç®¡ç†ï¼Œé¿å…åˆ›å»ºç©ºç›®å½•
- **âœ… å…¨é¢åŠŸèƒ½éªŒè¯**: 30ä¸ªæµ‹è¯•ç”¨ä¾‹100%é€šè¿‡ï¼Œè¦†ç›–è¡¨å•ã€æ¨¡æ€æ¡†ã€æ ‡ç­¾é¡µã€è¡¨æ ¼ç­‰æ ¸å¿ƒåŠŸèƒ½
- **ğŸš€ é«˜æ€§èƒ½æ‰§è¡Œ**: å¹³å‡æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹æ‰§è¡Œæ—¶é—´çº¦1.3ç§’ï¼Œæ€»æ‰§è¡Œæ—¶é—´38.5ç§’

## ğŸ—ï¸ æ¡†æ¶æ•´ä½“æ¶æ„

### æ¶æ„è®¾è®¡åŸåˆ™

æœ¬æ¡†æ¶é‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œéµå¾ªä»¥ä¸‹è®¾è®¡åŸåˆ™ï¼š

1. **åˆ†ç¦»å…³æ³¨ç‚¹**: å°†é¡µé¢æ“ä½œã€æµ‹è¯•é€»è¾‘ã€é…ç½®ç®¡ç†ã€å·¥å…·å‡½æ•°åˆ†ç¦»åˆ°ä¸åŒå±‚æ¬¡
2. **é«˜å†…èšä½è€¦åˆ**: æ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€ï¼Œæ¨¡å—é—´ä¾èµ–æœ€å°åŒ–
3. **å¯æ‰©å±•æ€§**: æ”¯æŒå¿«é€Ÿæ·»åŠ æ–°çš„é¡µé¢å¯¹è±¡ã€æµ‹è¯•ç”¨ä¾‹å’Œå·¥å…·ç±»
4. **å¯ç»´æŠ¤æ€§**: æ¸…æ™°çš„ä»£ç ç»“æ„å’Œå®Œå–„çš„æ–‡æ¡£ï¼Œä¾¿äºå›¢é˜Ÿåä½œ

### æ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æµ‹è¯•å±‚ (Tests)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   UI æµ‹è¯•ç”¨ä¾‹    â”‚  â”‚   API æµ‹è¯•ç”¨ä¾‹   â”‚  â”‚   é›†æˆæµ‹è¯•ç”¨ä¾‹   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      é¡µé¢å¯¹è±¡å±‚ (Pages)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    BasePage     â”‚  â”‚   LoginPage     â”‚  â”‚   HomePage      â”‚ â”‚
â”‚  â”‚   (åŸºç¡€é¡µé¢)     â”‚  â”‚   (ç™»å½•é¡µé¢)     â”‚  â”‚   (é¦–é¡µ)        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å·¥å…·å±‚ (Utils)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Logger Config  â”‚  â”‚ Screenshot Helperâ”‚  â”‚  Video Helper   â”‚ â”‚
â”‚  â”‚   (æ—¥å¿—é…ç½®)     â”‚  â”‚   (æˆªå›¾å·¥å…·)     â”‚  â”‚   (å½•å±å·¥å…·)     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      é…ç½®å±‚ (Config)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Env Config    â”‚  â”‚ Playwright Configâ”‚  â”‚   Pytest Config â”‚ â”‚
â”‚  â”‚   (ç¯å¢ƒé…ç½®)     â”‚  â”‚ (æµè§ˆå™¨é…ç½®)     â”‚  â”‚   (æµ‹è¯•é…ç½®)     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é©±åŠ¨å±‚ (Playwright)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚    Chromium     â”‚  â”‚     Firefox     â”‚  â”‚     WebKit      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµå‘

1. **æµ‹è¯•æ‰§è¡Œ**: Pytest è¯»å–é…ç½®æ–‡ä»¶ï¼Œåˆå§‹åŒ–æµ‹è¯•ç¯å¢ƒ
2. **ä¼šè¯åˆ›å»º**: è‡ªåŠ¨åˆ›å»ºå”¯ä¸€çš„æµ‹è¯•ä¼šè¯ç›®å½•ï¼Œç¡®ä¿æ–‡ä»¶éš”ç¦»
3. **æµè§ˆå™¨å¯åŠ¨**: Playwright æ ¹æ®é…ç½®å¯åŠ¨æŒ‡å®šæµè§ˆå™¨
4. **é¡µé¢æ“ä½œ**: æµ‹è¯•ç”¨ä¾‹é€šè¿‡é¡µé¢å¯¹è±¡æ‰§è¡Œå…·ä½“æ“ä½œ
5. **ç»“æœè®°å½•**: å·¥å…·ç±»è®°å½•æ—¥å¿—ã€æˆªå›¾ã€å½•å±ç­‰æµ‹è¯•æ•°æ®åˆ°ä¼šè¯ç›®å½•
6. **æŠ¥å‘Šç”Ÿæˆ**: Allure å’Œ HTML æŠ¥å‘Šç”Ÿæˆå™¨å¤„ç†æµ‹è¯•ç»“æœå¹¶ä¿å­˜åˆ°ä¼šè¯ç›®å½•

### ç›®å½•ç®¡ç†ä¼˜åŒ–

æ¡†æ¶é‡‡ç”¨æ™ºèƒ½çš„ç›®å½•ç®¡ç†ç­–ç•¥ï¼š

- **ä¼šè¯éš”ç¦»**: æ¯æ¬¡æµ‹è¯•è¿è¡Œåˆ›å»ºç‹¬ç«‹çš„ä¼šè¯ç›®å½• `test_session_YYYYMMDD_HHMMSS`
- **èµ„æºä¼˜åŒ–**: æˆªå›¾å’Œè§†é¢‘æ–‡ä»¶åªåœ¨å®é™…ä½¿ç”¨æ—¶åˆ›å»ºï¼Œé¿å…ç©ºç›®å½•
- **è‡ªåŠ¨æ¸…ç†**: å¯é…ç½®çš„å†å²ä¼šè¯æ¸…ç†æœºåˆ¶ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´
- **å¹¶è¡Œå®‰å…¨**: æ”¯æŒå¤šä¸ªæµ‹è¯•ä¼šè¯å¹¶è¡Œè¿è¡Œè€Œä¸å†²çª

## ğŸ“ é¡¹ç›®ç»“æ„

```
PlaywrightProject/
â”œâ”€â”€ .github/                    # GitHub ç›¸å…³é…ç½®
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ ci.yml              # CI/CD å·¥ä½œæµé…ç½®
â”‚       â””â”€â”€ test.yml            # æµ‹è¯•å·¥ä½œæµé…ç½®
â”œâ”€â”€ config/                     # é…ç½®ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ env_config.py           # ç¯å¢ƒé…ç½®ç®¡ç†
â”‚   â””â”€â”€ playwright_config.py    # Playwright æµè§ˆå™¨é…ç½®
â”œâ”€â”€ pages/                      # é¡µé¢å¯¹è±¡æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_page.py           # é¡µé¢å¯¹è±¡åŸºç±»
â”‚   â””â”€â”€ practice_page.py       # å…·ä½“é¡µé¢å¯¹è±¡å®ç°
â”œâ”€â”€ tests/                      # æµ‹è¯•ç”¨ä¾‹æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_test.py           # æµ‹è¯•åŸºç±»
â”‚   â”œâ”€â”€ test_practice_page.py  # é¡µé¢åŠŸèƒ½æµ‹è¯•
â”‚   â””â”€â”€ test_simple_practice.py # ç®€å•åŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ utils/                      # å·¥å…·ç±»æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ logger_config.py       # æ—¥å¿—é…ç½®å·¥å…·
â”‚   â”œâ”€â”€ screenshot_helper.py   # æˆªå›¾è¾…åŠ©å·¥å…·
â”‚   â””â”€â”€ video_helper.py        # å½•å±è¾…åŠ©å·¥å…·
â”œâ”€â”€ reports/                    # æµ‹è¯•æŠ¥å‘Šç›®å½•ï¼ˆæŒ‰ä¼šè¯ç»„ç»‡ï¼‰
â”‚   â””â”€â”€ test_session_YYYYMMDD_HHMMSS/  # æµ‹è¯•ä¼šè¯ç›®å½•
â”‚       â”œâ”€â”€ allure-results/    # Allure åŸå§‹æµ‹è¯•ç»“æœ
â”‚       â”œâ”€â”€ allure-report/     # Allure HTML æŠ¥å‘Š
â”‚       â”œâ”€â”€ screenshots/       # æµ‹è¯•æˆªå›¾æ–‡ä»¶
â”‚       â”œâ”€â”€ videos/            # æµ‹è¯•å½•å±æ–‡ä»¶
â”‚       â””â”€â”€ html/              # HTML æµ‹è¯•æŠ¥å‘Š
â”œâ”€â”€ logs/                      # æ—¥å¿—æ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ pytest.log            # Pytest è¿è¡Œæ—¥å¿—
â”œâ”€â”€ conftest.py               # Pytest å…¨å±€é…ç½®å’Œ Fixtures
â”œâ”€â”€ pytest.ini               # Pytest é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt          # Python ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ practice_page.html        # æµ‹è¯•ç”¨çš„ç¤ºä¾‹é¡µé¢
â”œâ”€â”€ Dockerfile               # Docker å®¹å™¨é…ç½®
â”œâ”€â”€ docker-compose.yml       # Docker Compose é…ç½®
â””â”€â”€ README.md                # é¡¹ç›®æ–‡æ¡£
```

## ğŸ”§ ç¯å¢ƒè¦æ±‚ä¸ä¾èµ–é¡¹

### ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Windows 10+, macOS 10.14+, Ubuntu 18.04+
- **Python**: 3.9+ (æ¨è 3.11+)
- **Node.js**: 16+ (Playwright æµè§ˆå™¨é©±åŠ¨ä¾èµ–)
- **å†…å­˜**: æœ€å°‘ 4GBï¼Œæ¨è 8GB+
- **ç£ç›˜ç©ºé—´**: è‡³å°‘ 2GB å¯ç”¨ç©ºé—´

### æ ¸å¿ƒä¾èµ–

#### æµ‹è¯•æ¡†æ¶æ ¸å¿ƒ
```
playwright>=1.40.0          # Web è‡ªåŠ¨åŒ–æµ‹è¯•å¼•æ“
pytest>=7.4.0              # Python æµ‹è¯•æ¡†æ¶
pytest-playwright>=0.4.0   # Playwright ä¸ Pytest é›†æˆ
```

#### æµ‹è¯•æŠ¥å‘Šå’Œæ–‡æ¡£
```
allure-pytest>=2.13.0      # Allure æŠ¥å‘Šé›†æˆ
pytest-html>=4.1.0         # HTML æµ‹è¯•æŠ¥å‘Š
```

#### å¹¶è¡Œæ‰§è¡Œå’Œé‡è¯•
```
pytest-xdist>=3.5.0        # å¹¶è¡Œæµ‹è¯•æ‰§è¡Œ
pytest-rerunfailures>=12.0 # å¤±è´¥é‡è¯•æœºåˆ¶
```

#### æ—¥å¿—å’Œå·¥å…·
```
loguru>=0.7.0              # ç°ä»£åŒ–æ—¥å¿—åº“
pydantic>=2.5.0            # æ•°æ®éªŒè¯å’Œé…ç½®ç®¡ç†
```

#### æ•°æ®å¤„ç†
```
pytest-mock>=3.12.0        # Mock æµ‹è¯•å·¥å…·
faker>=20.1.0              # æµ‹è¯•æ•°æ®ç”Ÿæˆ
```

#### é…ç½®å’Œç¯å¢ƒ
```
python-dotenv>=1.0.0       # ç¯å¢ƒå˜é‡ç®¡ç†
toml>=0.10.0               # TOML é…ç½®æ–‡ä»¶æ”¯æŒ
```

#### å›¾åƒå’Œè§†é¢‘å¤„ç†
```
Pillow>=10.1.0             # å›¾åƒå¤„ç†
opencv-python>=4.8.0       # è§†é¢‘å¤„ç†
```

#### å¼€å‘å’Œè°ƒè¯•
```
pytest-sugar>=0.9.0        # ç¾åŒ–æµ‹è¯•è¾“å‡º
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd PlaywrightProject

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ (æ¨è)
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows
venv\Scripts\activate
# macOS/Linux
source venv/bin/activate
```

### 2. å®‰è£…ä¾èµ–

```bash
# å®‰è£… Python ä¾èµ–
pip install -r requirements.txt

# å®‰è£… Playwright æµè§ˆå™¨
playwright install

# å®‰è£…ç³»ç»Ÿä¾èµ– (Linux)
playwright install-deps
```

### 3. éªŒè¯å®‰è£…

```bash
# æ£€æŸ¥ Playwright å®‰è£…
playwright --version

# æ£€æŸ¥ pytest å®‰è£…
pytest --version

# è¿è¡Œç¤ºä¾‹æµ‹è¯•
pytest tests/test_simple_practice.py -v
```

### 4. åŸºæœ¬ä½¿ç”¨

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆæ¨èï¼‰
pytest -v --tb=short

# è¿è¡ŒæŒ‡å®šæµ‹è¯•æ–‡ä»¶
pytest tests/test_practice_page.py -v

# è¿è¡ŒæŒ‡å®šæµ‹è¯•ç”¨ä¾‹
pytest tests/test_practice_page.py::TestPracticePage::test_basic_form_submission -v

# ç”Ÿæˆ Allure æŠ¥å‘Š
pytest --alluredir=reports/allure-results
allure serve reports/allure-results

# å¹¶è¡Œæ‰§è¡Œæµ‹è¯•ï¼ˆæé«˜æ•ˆç‡ï¼‰
pytest -n auto -v
```

### 5. æ¡†æ¶éªŒè¯ç»“æœ

âœ… **æœ€æ–°æµ‹è¯•ç»“æœ**ï¼ˆå·²éªŒè¯ï¼‰:
- **æ€»æµ‹è¯•ç”¨ä¾‹**: 30ä¸ª
- **é€šè¿‡ç‡**: 100%
- **æ‰§è¡Œæ—¶é—´**: 38.5ç§’
- **å¹¶è¡Œworker**: 16ä¸ª
- **å¹³å‡ç”¨ä¾‹æ‰§è¡Œæ—¶é—´**: 1.3ç§’

**åŠŸèƒ½è¦†ç›–éªŒè¯**:
- âœ… åŸºç¡€é¡µé¢æ“ä½œï¼ˆç‚¹å‡»ã€è¾“å…¥ã€é€‰æ‹©ï¼‰
- âœ… è¡¨å•å¤„ç†ï¼ˆå¡«å†™ã€æäº¤ã€éªŒè¯ã€é‡ç½®ï¼‰
- âœ… æ¨¡æ€æ¡†äº¤äº’ï¼ˆæ‰“å¼€ã€å…³é—­ã€è¾“å…¥ã€ç¡®è®¤/å–æ¶ˆï¼‰
- âœ… æ ‡ç­¾é¡µåˆ‡æ¢ï¼ˆå¯¼èˆªå’Œå†…å®¹éªŒè¯ï¼‰
- âœ… è¡¨æ ¼æ“ä½œï¼ˆæ·»åŠ è¡Œã€åˆ é™¤è¡Œã€æ•°æ®éªŒè¯ï¼‰
- âœ… è¿›åº¦æ¡åŠŸèƒ½ï¼ˆå¯åŠ¨å’Œå®ŒæˆéªŒè¯ï¼‰
- âœ… è­¦å‘Šå¯¹è¯æ¡†ï¼ˆæµè§ˆå™¨åŸç”Ÿå¯¹è¯æ¡†å¤„ç†ï¼‰
- âœ… å¹¶å‘æµ‹è¯•ï¼ˆå¤šworkerå¹¶è¡Œæ‰§è¡Œï¼‰
- âœ… æŠ¥å‘Šç”Ÿæˆï¼ˆHTMLå’ŒAllureæŠ¥å‘Šï¼‰

## ğŸ› ï¸ å·¥å…·ç±»è¯¦è§£

### 1. BasePage (é¡µé¢å¯¹è±¡åŸºç±»)

**æ–‡ä»¶ä½ç½®**: `pages/base_page.py`

**å®ç°åŸç†**: 
- é‡‡ç”¨æŠ½è±¡åŸºç±»è®¾è®¡ï¼Œå®šä¹‰é¡µé¢å¯¹è±¡çš„é€šç”¨æ¥å£
- å°è£… Playwright çš„åº•å±‚ APIï¼Œæä¾›é«˜çº§é¡µé¢æ“ä½œæ–¹æ³•
- é›†æˆæ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†æœºåˆ¶
- æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œæé«˜ä»£ç å¯è¯»æ€§

**æ ¸å¿ƒåŠŸèƒ½**:

#### é¡µé¢å¯¼èˆª
```python
def navigate(self, url: str = None, wait_until: str = "domcontentloaded") -> 'BasePage':
    """å¯¼èˆªåˆ°æŒ‡å®šé¡µé¢ï¼Œæ”¯æŒç­‰å¾…ç­–ç•¥é…ç½®"""
```

#### å…ƒç´ æ“ä½œ
```python
def click(self, selector: str, timeout: int = None, force: bool = False) -> 'BasePage':
    """ç‚¹å‡»å…ƒç´ ï¼Œæ”¯æŒå¼ºåˆ¶ç‚¹å‡»å’Œè¶…æ—¶é…ç½®"""

def fill(self, selector: str, value: str, timeout: int = None, clear: bool = True) -> 'BasePage':
    """å¡«å……è¾“å…¥æ¡†ï¼Œæ”¯æŒæ¸…ç©ºå’Œè¶…æ—¶é…ç½®"""

def select_option(self, selector: str, value: str = None, label: str = None) -> 'BasePage':
    """é€‰æ‹©ä¸‹æ‹‰æ¡†é€‰é¡¹ï¼Œæ”¯æŒæŒ‰å€¼æˆ–æ ‡ç­¾é€‰æ‹©"""
```

#### å…ƒç´ çŠ¶æ€æ£€æŸ¥
```python
def is_visible(self, selector: str, timeout: int = None) -> bool:
    """æ£€æŸ¥å…ƒç´ æ˜¯å¦å¯è§"""

def is_enabled(self, selector: str, timeout: int = None) -> bool:
    """æ£€æŸ¥å…ƒç´ æ˜¯å¦å¯ç”¨"""

def get_text(self, selector: str, timeout: int = None) -> str:
    """è·å–å…ƒç´ æ–‡æœ¬å†…å®¹"""
```

#### ç­‰å¾…æœºåˆ¶
```python
def wait_for_element(self, selector: str, state: str = "visible", timeout: int = None) -> Locator:
    """ç­‰å¾…å…ƒç´ è¾¾åˆ°æŒ‡å®šçŠ¶æ€"""

def wait_for_page_load(self, timeout: int = None) -> None:
    """ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½"""
```

**ä½¿ç”¨ç¤ºä¾‹**:
```python
class LoginPage(BasePage):
    @property
    def url(self) -> str:
        return "https://example.com/login"
    
    @property 
    def title(self) -> str:
        return "ç™»å½•é¡µé¢"
    
    def login(self, username: str, password: str):
        return (self
                .fill("#username", username)
                .fill("#password", password)
                .click("#login-btn")
                .wait_for_page_load())
```

### 2. LoggerConfig (æ—¥å¿—é…ç½®å·¥å…·)

**æ–‡ä»¶ä½ç½®**: `utils/logger_config.py`

**å®ç°åŸç†**:
- åŸºäº Loguru åº“ï¼Œæä¾›ç»“æ„åŒ–æ—¥å¿—è®°å½•
- æ”¯æŒå¤šç§è¾“å‡ºç›®æ ‡ï¼šæ§åˆ¶å°ã€æ–‡ä»¶ã€è¿œç¨‹æœåŠ¡
- å®ç°æ—¥å¿—è½®è½¬ã€å‹ç¼©å’Œæ¸…ç†æœºåˆ¶
- æä¾›æµ‹è¯•æ­¥éª¤è¿½è¸ªå’Œæ€§èƒ½ç›‘æ§

**æ ¸å¿ƒåŠŸèƒ½**:

#### æ—¥å¿—é…ç½®
```python
def setup_logger(
    self,
    level: str = "INFO",
    console_output: bool = True,
    file_output: bool = True,
    rotation: str = "10 MB",
    retention: str = "30 days",
    compression: str = "zip"
) -> None:
    """è®¾ç½®æ—¥å¿—é…ç½®"""
```

#### æµ‹è¯•æ­¥éª¤è®°å½•
```python
def log_test_step(self, step_name: str, description: str = "") -> None:
    """è®°å½•æµ‹è¯•æ­¥éª¤"""

def log_page_action(self, action: str, target: str, extra_info: str = "") -> None:
    """è®°å½•é¡µé¢æ“ä½œ"""
```

#### æ€§èƒ½ç›‘æ§
```python
def log_performance(self, operation: str, duration: float, threshold: float = 5.0) -> None:
    """è®°å½•æ€§èƒ½æ•°æ®"""
```

**é…ç½®ç¤ºä¾‹**:
```python
# å¼€å‘ç¯å¢ƒé…ç½®
logger_config.setup_logger(
    level="DEBUG",
    console_output=True,
    file_output=True,
    rotation="50 MB",
    retention="7 days"
)

# ç”Ÿäº§ç¯å¢ƒé…ç½®
logger_config.setup_logger(
    level="INFO",
    console_output=False,
    file_output=True,
    rotation="100 MB",
    retention="90 days",
    compression="gz"
)
```

### 3. ScreenshotHelper (æˆªå›¾å·¥å…·)

**æ–‡ä»¶ä½ç½®**: `utils/screenshot_helper.py`

**å®ç°åŸç†**:
- å°è£… Playwright çš„æˆªå›¾åŠŸèƒ½
- æ”¯æŒå…¨é¡µé¢ã€å…ƒç´ çº§åˆ«ã€è§†çª—æˆªå›¾
- æ™ºèƒ½ç›®å½•ç®¡ç†ï¼ŒåŸºäºæµ‹è¯•ä¼šè¯åˆ›å»ºæˆªå›¾ç›®å½•
- è‡ªåŠ¨ç”Ÿæˆå”¯ä¸€æ–‡ä»¶åå’Œç›®å½•ç»“æ„
- é›†æˆå¤±è´¥è‡ªåŠ¨æˆªå›¾æœºåˆ¶
- ä¼˜åŒ–çš„èµ„æºç®¡ç†ï¼Œé¿å…åˆ›å»ºç©ºç›®å½•

**æ ¸å¿ƒåŠŸèƒ½**:

#### æˆªå›¾ç±»å‹
```python
def take_screenshot(self, name: str = None, full_page: bool = True) -> str:
    """æˆªå–é¡µé¢æˆªå›¾"""

def take_element_screenshot(self, selector: str, name: str = None) -> str:
    """æˆªå–å…ƒç´ æˆªå›¾"""

def take_failure_screenshot(self, test_name: str, error_msg: str = "") -> str:
    """å¤±è´¥æ—¶è‡ªåŠ¨æˆªå›¾"""
```

#### æˆªå›¾é…ç½®
```python
def configure_screenshot(
    self,
    quality: int = 90,
    format: str = "png",
    clip: dict = None,
    mask: list = None
) -> None:
    """é…ç½®æˆªå›¾å‚æ•°"""
```

### 4. VideoHelper (å½•å±å·¥å…·)

**æ–‡ä»¶ä½ç½®**: `utils/video_helper.py`

**å®ç°åŸç†**:
- åŸºäº Playwright çš„è§†é¢‘å½•åˆ¶åŠŸèƒ½
- æ”¯æŒæµ‹è¯•æ‰§è¡Œè¿‡ç¨‹çš„å®Œæ•´å½•åˆ¶
- æ™ºèƒ½ç›®å½•ç®¡ç†ï¼ŒåŸºäºæµ‹è¯•ä¼šè¯åˆ›å»ºè§†é¢‘ç›®å½•
- è‡ªåŠ¨å¤„ç†è§†é¢‘æ–‡ä»¶çš„ä¿å­˜å’Œæ¸…ç†
- æä¾›è§†é¢‘å‹ç¼©å’Œæ ¼å¼è½¬æ¢
- ä¼˜åŒ–çš„èµ„æºç®¡ç†ï¼Œé¿å…åˆ›å»ºç©ºç›®å½•

**æ ¸å¿ƒåŠŸèƒ½**:

#### å½•å±æ§åˆ¶
```python
def start_recording(self, video_path: str = None) -> None:
    """å¼€å§‹å½•å±"""

def stop_recording(self) -> str:
    """åœæ­¢å½•å±å¹¶è¿”å›æ–‡ä»¶è·¯å¾„"""

def configure_video(
    self,
    size: dict = None,
    frame_rate: int = 25,
    quality: str = "medium"
) -> None:
    """é…ç½®å½•å±å‚æ•°"""
```

## âš™ï¸ é…ç½®æ–‡ä»¶è¯´æ˜

### 1. pytest.ini (Pytest é…ç½®)

**æ–‡ä»¶ä½ç½®**: `pytest.ini`

**ä¸»è¦é…ç½®é¡¹**:

#### åŸºç¡€é…ç½®
```ini
[pytest]
# ä¸¥æ ¼æ¨¡å¼é…ç½®
addopts = 
    --strict-markers        # ä¸¥æ ¼æ ‡è®°æ¨¡å¼
    --strict-config         # ä¸¥æ ¼é…ç½®æ¨¡å¼
    --verbose              # è¯¦ç»†è¾“å‡º
    --tb=short             # ç®€çŸ­é”™è¯¯å›æº¯
```

#### æŠ¥å‘Šé…ç½®
```ini
# æµ‹è¯•æŠ¥å‘Š
--alluredir=reports/allure-results    # Allure ç»“æœç›®å½•
--html=reports/html/report.html       # HTML æŠ¥å‘Šè·¯å¾„
--self-contained-html                 # è‡ªåŒ…å« HTML æŠ¥å‘Š
```

#### æ‰§è¡Œé…ç½®
```ini
# é‡è¯•å’Œå¹¶è¡Œ
--reruns=1                # å¤±è´¥é‡è¯•æ¬¡æ•°
--reruns-delay=2          # é‡è¯•å»¶è¿Ÿ(ç§’)
--maxfail=5              # æœ€å¤§å¤±è´¥æ•°
--durations=10           # æ˜¾ç¤ºæœ€æ…¢çš„10ä¸ªæµ‹è¯•
-n auto                  # è‡ªåŠ¨å¹¶è¡Œè¿›ç¨‹æ•°
--dist=worksteal         # å·¥ä½œçªƒå–åˆ†å‘ç­–ç•¥
```

#### æµ‹è¯•å‘ç°
```ini
# æµ‹è¯•æ–‡ä»¶æ¨¡å¼
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*
testpaths = tests
```

#### æ ‡è®°å®šä¹‰
```ini
markers =
    smoke: å†’çƒŸæµ‹è¯•
    regression: å›å½’æµ‹è¯•
    ui: UIæµ‹è¯•
    slow: æ…¢é€Ÿæµ‹è¯•
    skip_in_ci: åœ¨CIä¸­è·³è¿‡çš„æµ‹è¯•
```

#### æ—¥å¿—é…ç½®
```ini
# æ§åˆ¶å°æ—¥å¿—
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s

# æ–‡ä»¶æ—¥å¿—
log_file = logs/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] %(filename)s:%(lineno)d: %(message)s
```

### 2. env_config.py (ç¯å¢ƒé…ç½®)

**æ–‡ä»¶ä½ç½®**: `config/env_config.py`

**é…ç½®ç»“æ„**:

#### ç¯å¢ƒæšä¸¾
```python
class Environment(str, Enum):
    TEST = "test"        # æµ‹è¯•ç¯å¢ƒ
    PROD = "prod"        # ç”Ÿäº§ç¯å¢ƒ
```

#### é…ç½®æ¨¡å‹
```python
class EnvironmentConfig(BaseModel):
    name: str                           # ç¯å¢ƒåç§°
    timeout: int = 30000                # é»˜è®¤è¶…æ—¶æ—¶é—´(æ¯«ç§’)
    headless: bool = True               # æ˜¯å¦æ— å¤´æ¨¡å¼
    slow_mo: int = 0                    # æ…¢åŠ¨ä½œå»¶è¿Ÿ(æ¯«ç§’)
    video_record: bool = False          # æ˜¯å¦å½•åˆ¶è§†é¢‘
    screenshot_on_failure: bool = True  # å¤±è´¥æ—¶æ˜¯å¦æˆªå›¾
    parallel_workers: int = 4           # å¹¶è¡Œå·¥ä½œè¿›ç¨‹æ•°
    retry_times: int = 2                # é‡è¯•æ¬¡æ•°
```

#### ç¯å¢ƒé…ç½®ç¤ºä¾‹
```python
ENVIRONMENT_CONFIGS = {
    Environment.TEST: EnvironmentConfig(
        name="æµ‹è¯•ç¯å¢ƒ",
        headless=True,
        video_record=True,
        parallel_workers=4
    ),
    
    Environment.PROD: EnvironmentConfig(
        name="ç”Ÿäº§ç¯å¢ƒ",
        headless=True,
        timeout=60000,
        parallel_workers=8,
        retry_times=3
    )
}
```

### 3. playwright_config.py (Playwright é…ç½®)

**æ–‡ä»¶ä½ç½®**: `config/playwright_config.py`

**ä¸»è¦é…ç½®**:

#### æµè§ˆå™¨é…ç½®
```python
class PlaywrightConfig:
    def get_browser_config(self, browser_name: str = "chromium") -> dict:
        return {
            "headless": self.env_config.headless,
            "slow_mo": self.env_config.slow_mo,
            "args": [
                "--no-sandbox",
                "--disable-dev-shm-usage",
                "--disable-gpu"
            ],
            "viewport": {"width": 1920, "height": 1080},
            "ignore_https_errors": True,
            "java_script_enabled": True
        }
```

#### ä¸Šä¸‹æ–‡é…ç½®
```python
def get_context_config(self) -> dict:
    return {
        "viewport": {"width": 1920, "height": 1080},
        "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",
        "locale": "zh-CN",
        "timezone_id": "Asia/Shanghai",
        "permissions": ["geolocation", "notifications"],
        "record_video_dir": "reports/videos/" if self.env_config.video_record else None,
        "record_video_size": {"width": 1920, "height": 1080}
    }
```

### 4. conftest.py (Pytest å…¨å±€é…ç½®)

**æ–‡ä»¶ä½ç½®**: `conftest.py`

**ä¸»è¦ Fixtures**:

#### æµè§ˆå™¨å’Œé¡µé¢ Fixtures
```python
@pytest.fixture(scope="session")
def browser_context_args(browser_context_args):
    """é…ç½®æµè§ˆå™¨ä¸Šä¸‹æ–‡å‚æ•°"""
    return {
        **browser_context_args,
        "viewport": {"width": 1920, "height": 1080},
        "record_video_dir": "reports/videos/"
    }

@pytest.fixture(scope="function")
def page(context):
    """åˆ›å»ºé¡µé¢å®ä¾‹"""
    page = context.new_page()
    yield page
    page.close()
```

#### æµ‹è¯•æ•°æ® Fixtures
```python
@pytest.fixture
def test_data():
    """æä¾›æµ‹è¯•æ•°æ®"""
    return {
        "valid_user": {"username": "testuser", "password": "password123"},
        "invalid_user": {"username": "invalid", "password": "wrong"}
    }
```

## ğŸ“ æµ‹è¯•ç”¨ä¾‹ç¼–å†™è§„èŒƒ

### 1. å‘½åè§„èŒƒ

#### æ–‡ä»¶å‘½å
- æµ‹è¯•æ–‡ä»¶ï¼š`test_<åŠŸèƒ½æ¨¡å—>.py`
- é¡µé¢å¯¹è±¡ï¼š`<é¡µé¢åç§°>_page.py`
- å·¥å…·ç±»ï¼š`<åŠŸèƒ½åç§°>_helper.py`

#### ç±»å’Œæ–¹æ³•å‘½å
```python
# æµ‹è¯•ç±»å‘½å
class TestUserLogin:          # Test + åŠŸèƒ½æè¿°
class TestProductSearch:      # ä½¿ç”¨é©¼å³°å‘½åæ³•

# æµ‹è¯•æ–¹æ³•å‘½å
def test_valid_user_login():           # test_ + å…·ä½“æµ‹è¯•åœºæ™¯
def test_invalid_password_login():     # ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”
def test_empty_username_validation():  # æè¿°æ€§å‘½å
```

### 2. æµ‹è¯•ç”¨ä¾‹ç»“æ„

#### AAA æ¨¡å¼ (Arrange-Act-Assert)
```python
def test_user_login_success(self, page, test_data):
    """æµ‹è¯•ç”¨æˆ·æˆåŠŸç™»å½•"""
    # Arrange - å‡†å¤‡æµ‹è¯•æ•°æ®å’Œç¯å¢ƒ
    login_page = LoginPage(page)
    user_data = test_data["valid_user"]
    
    # Act - æ‰§è¡Œæµ‹è¯•æ“ä½œ
    login_page.navigate()
    login_page.login(user_data["username"], user_data["password"])
    
    # Assert - éªŒè¯æµ‹è¯•ç»“æœ
    assert login_page.is_login_successful()
    assert "dashboard" in page.url
```

#### Given-When-Then æ¨¡å¼
```python
@allure.feature("ç”¨æˆ·ç™»å½•")
@allure.story("æ­£å¸¸ç™»å½•æµç¨‹")
def test_user_login_with_valid_credentials(self, page):
    """æµ‹è¯•ç”¨æˆ·ä½¿ç”¨æœ‰æ•ˆå‡­æ®ç™»å½•"""
    with allure.step("Given ç”¨æˆ·åœ¨ç™»å½•é¡µé¢"):
        login_page = LoginPage(page)
        login_page.navigate()
    
    with allure.step("When ç”¨æˆ·è¾“å…¥æœ‰æ•ˆçš„ç”¨æˆ·åå’Œå¯†ç "):
        login_page.fill_username("testuser")
        login_page.fill_password("password123")
        login_page.click_login_button()
    
    with allure.step("Then ç”¨æˆ·åº”è¯¥æˆåŠŸç™»å½•åˆ°ç³»ç»Ÿ"):
        assert login_page.is_login_successful()
        assert "æ¬¢è¿" in login_page.get_welcome_message()
```

### 3. æµ‹è¯•æ•°æ®ç®¡ç†

#### ä½¿ç”¨ Fixtures æä¾›æµ‹è¯•æ•°æ®
```python
@pytest.fixture
def user_credentials():
    """ç”¨æˆ·å‡­æ®æµ‹è¯•æ•°æ®"""
    return {
        "valid": {"username": "testuser", "password": "Test123!"},
        "invalid_password": {"username": "testuser", "password": "wrong"},
        "invalid_username": {"username": "nonexistent", "password": "Test123!"},
        "empty": {"username": "", "password": ""}
    }

@pytest.mark.parametrize("credential_type,expected_result", [
    ("valid", True),
    ("invalid_password", False),
    ("invalid_username", False),
    ("empty", False)
])
def test_login_scenarios(self, page, user_credentials, credential_type, expected_result):
    """å‚æ•°åŒ–æµ‹è¯•ä¸åŒç™»å½•åœºæ™¯"""
    login_page = LoginPage(page)
    credentials = user_credentials[credential_type]
    
    login_page.navigate()
    result = login_page.login(credentials["username"], credentials["password"])
    
    assert result == expected_result
```

#### ä½¿ç”¨ Faker ç”ŸæˆåŠ¨æ€æ•°æ®
```python
from faker import Faker

@pytest.fixture
def fake_user_data():
    """ç”Ÿæˆè™šå‡ç”¨æˆ·æ•°æ®"""
    fake = Faker('zh_CN')
    return {
        "name": fake.name(),
        "email": fake.email(),
        "phone": fake.phone_number(),
        "address": fake.address()
    }
```

### 4. æ–­è¨€æœ€ä½³å®è·µ

#### ä½¿ç”¨æè¿°æ€§æ–­è¨€æ¶ˆæ¯
```python
# å¥½çš„æ–­è¨€
assert login_page.is_visible("#welcome-message"), "ç™»å½•ååº”è¯¥æ˜¾ç¤ºæ¬¢è¿æ¶ˆæ¯"
assert "dashboard" in page.url, f"ç™»å½•ååº”è¯¥è·³è½¬åˆ°ä»ªè¡¨æ¿é¡µé¢ï¼Œå½“å‰URL: {page.url}"

# é¿å…çš„æ–­è¨€
assert True  # æ²¡æœ‰æ„ä¹‰çš„æ–­è¨€
assert login_page.is_visible("#welcome-message")  # ç¼ºå°‘é”™è¯¯æ¶ˆæ¯
```

#### ä½¿ç”¨ Playwright çš„å†…ç½®æ–­è¨€
```python
from playwright.sync_api import expect

# æ¨èä½¿ç”¨ Playwright çš„ expect
expect(page.locator("#username")).to_be_visible()
expect(page.locator("#error-message")).to_have_text("ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
expect(page).to_have_url(re.compile(r".*/dashboard"))
```

### 5. é”™è¯¯å¤„ç†å’Œé‡è¯•

#### æ™ºèƒ½ç­‰å¾…å’Œé‡è¯•
```python
def test_dynamic_content_loading(self, page):
    """æµ‹è¯•åŠ¨æ€å†…å®¹åŠ è½½"""
    page.goto("https://example.com/dynamic")
    
    # ç­‰å¾…åŠ¨æ€å†…å®¹åŠ è½½
    expect(page.locator("#dynamic-content")).to_be_visible(timeout=30000)
    
    # ä½¿ç”¨é‡è¯•æœºåˆ¶å¤„ç†ä¸ç¨³å®šçš„å…ƒç´ 
    @retry(stop=stop_after_attempt(3), wait=wait_fixed(1))
    def click_unstable_element():
        page.locator("#unstable-button").click()
        expect(page.locator("#result")).to_be_visible()
    
    click_unstable_element()
```

#### å¼‚å¸¸å¤„ç†
```python
def test_with_error_handling(self, page):
    """å¸¦é”™è¯¯å¤„ç†çš„æµ‹è¯•ç”¨ä¾‹"""
    try:
        login_page = LoginPage(page)
        login_page.navigate()
        login_page.login("testuser", "password")
        
        # éªŒè¯ç™»å½•ç»“æœ
        assert login_page.is_login_successful()
        
    except TimeoutError as e:
        pytest.fail(f"é¡µé¢åŠ è½½è¶…æ—¶: {str(e)}")
    except AssertionError as e:
        # å¤±è´¥æ—¶æˆªå›¾
        screenshot_path = page.screenshot(path="reports/screenshots/login_failed.png")
        allure.attach.file(screenshot_path, name="ç™»å½•å¤±è´¥æˆªå›¾", attachment_type=allure.attachment_type.PNG)
        raise
    except Exception as e:
        pytest.fail(f"æµ‹è¯•æ‰§è¡Œå‡ºç°æœªé¢„æœŸé”™è¯¯: {str(e)}")
```

### 6. æµ‹è¯•æ ‡è®°å’Œåˆ†ç»„

#### ä½¿ç”¨ pytest æ ‡è®°
```python
@pytest.mark.smoke
def test_critical_user_login():
    """å†’çƒŸæµ‹è¯•ï¼šå…³é”®ç”¨æˆ·ç™»å½•åŠŸèƒ½"""
    pass

@pytest.mark.regression
@pytest.mark.slow
def test_comprehensive_user_workflow():
    """å›å½’æµ‹è¯•ï¼šå®Œæ•´ç”¨æˆ·å·¥ä½œæµç¨‹"""
    pass

@pytest.mark.skip_in_ci
def test_manual_verification_required():
    """éœ€è¦æ‰‹åŠ¨éªŒè¯çš„æµ‹è¯•ï¼ŒCIä¸­è·³è¿‡"""
    pass
```

#### è¿è¡Œç‰¹å®šæ ‡è®°çš„æµ‹è¯•
```bash
# åªè¿è¡Œå†’çƒŸæµ‹è¯•
pytest -m smoke

# è¿è¡Œå›å½’æµ‹è¯•ä½†æ’é™¤æ…¢é€Ÿæµ‹è¯•
pytest -m "regression and not slow"

# åœ¨CIç¯å¢ƒä¸­æ’é™¤ç‰¹å®šæµ‹è¯•
pytest -m "not skip_in_ci"
```

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### 1. åŸºç¡€æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹

#### ç®€å•è¡¨å•æµ‹è¯•
```python
import pytest
from pages.practice_page import PracticePage

class TestBasicForm:
    """åŸºç¡€è¡¨å•æµ‹è¯•"""
    
    def test_form_submission(self, page):
        """æµ‹è¯•è¡¨å•æäº¤åŠŸèƒ½"""
        # åˆå§‹åŒ–é¡µé¢å¯¹è±¡
        practice_page = PracticePage(page)
        
        # å¯¼èˆªåˆ°æµ‹è¯•é¡µé¢
        practice_page.navigate()
        
        # å¡«å†™è¡¨å•
        practice_page.fill_basic_form(
            username="testuser",
            email="test@example.com",
            age=25
        )
        
        # æäº¤è¡¨å•
        practice_page.submit_form()
        
        # éªŒè¯æäº¤ç»“æœ
        assert practice_page.is_form_submitted_successfully()
        assert "æäº¤æˆåŠŸ" in practice_page.get_success_message()
    
    def test_form_validation(self, page):
        """æµ‹è¯•è¡¨å•éªŒè¯åŠŸèƒ½"""
        practice_page = PracticePage(page)
        practice_page.navigate()
        
        # æäº¤ç©ºè¡¨å•
        practice_page.submit_form()
        
        # éªŒè¯é”™è¯¯æ¶ˆæ¯
        assert practice_page.has_validation_errors()
        assert "ç”¨æˆ·åä¸èƒ½ä¸ºç©º" in practice_page.get_validation_error("username")
```

#### å¤æ‚äº¤äº’æµ‹è¯•
```python
class TestAdvancedInteractions:
    """é«˜çº§äº¤äº’æµ‹è¯•"""
    
    @pytest.mark.slow
    def test_multi_step_workflow(self, page, test_data):
        """æµ‹è¯•å¤šæ­¥éª¤å·¥ä½œæµç¨‹"""
        practice_page = PracticePage(page)
        practice_page.navigate()
        
        # æ­¥éª¤1ï¼šå¡«å†™åŸºæœ¬ä¿¡æ¯
        with allure.step("å¡«å†™åŸºæœ¬ä¿¡æ¯"):
            practice_page.fill_basic_form(**test_data["user_info"])
        
        # æ­¥éª¤2ï¼šé€‰æ‹©é€‰é¡¹
        with allure.step("é€‰æ‹©ç›¸å…³é€‰é¡¹"):
            practice_page.select_country("china")
            practice_page.select_hobbies(["reading", "music"])
        
        # æ­¥éª¤3ï¼šå¤„ç†å¼¹çª—
        with allure.step("å¤„ç†ç¡®è®¤å¼¹çª—"):
            practice_page.click_confirm_button()
            practice_page.handle_confirm_dialog(accept=True)
        
        # æ­¥éª¤4ï¼šéªŒè¯æœ€ç»ˆç»“æœ
        with allure.step("éªŒè¯å·¥ä½œæµç¨‹å®Œæˆ"):
            assert practice_page.is_workflow_completed()
    
    def test_dynamic_content_interaction(self, page):
        """æµ‹è¯•åŠ¨æ€å†…å®¹äº¤äº’"""
        practice_page = PracticePage(page)
        practice_page.navigate()
        
        # è§¦å‘åŠ¨æ€å†…å®¹åŠ è½½
        practice_page.start_progress_bar()
        
        # ç­‰å¾…è¿›åº¦æ¡å®Œæˆ
        practice_page.wait_for_progress_completion(timeout=30000)
        
        # éªŒè¯åŠ¨æ€å†…å®¹
        assert practice_page.get_progress_percentage() == "100%"
        assert practice_page.is_progress_completed()
```

### 2. é¡µé¢å¯¹è±¡å®ç°ç¤ºä¾‹

```python
from pages.base_page import BasePage
from typing import List

class PracticePage(BasePage):
    """ç»ƒä¹ é¡µé¢å¯¹è±¡"""
    
    @property
    def url(self) -> str:
        return "http://localhost:8000/practice_page.html"
    
    @property
    def title(self) -> str:
        return "Playwright ç»ƒä¹ é¡µé¢"
    
    # é¡µé¢å…ƒç´ å®šä½å™¨
    USERNAME_INPUT = "[data-testid='username-input']"
    EMAIL_INPUT = "[data-testid='email-input']"
    AGE_INPUT = "[data-testid='age-input']"
    SUBMIT_BUTTON = "[data-testid='submit-btn']"
    SUCCESS_MESSAGE = ".success-message"
    
    def fill_basic_form(self, username: str, email: str, age: int) -> 'PracticePage':
        """å¡«å†™åŸºç¡€è¡¨å•"""
        return (self
                .fill(self.USERNAME_INPUT, username)
                .fill(self.EMAIL_INPUT, email)
                .fill(self.AGE_INPUT, str(age)))
    
    def submit_form(self) -> 'PracticePage':
        """æäº¤è¡¨å•"""
        return self.click(self.SUBMIT_BUTTON)
    
    def is_form_submitted_successfully(self) -> bool:
        """æ£€æŸ¥è¡¨å•æ˜¯å¦æäº¤æˆåŠŸ"""
        return self.is_visible(self.SUCCESS_MESSAGE)
    
    def get_success_message(self) -> str:
        """è·å–æˆåŠŸæ¶ˆæ¯"""
        return self.get_text(self.SUCCESS_MESSAGE)
    
    def select_hobbies(self, hobbies: List[str]) -> 'PracticePage':
        """é€‰æ‹©å…´è¶£çˆ±å¥½"""
        for hobby in hobbies:
            self.click(f"[data-testid='hobby-{hobby}']", force=True)
        return self
    
    def handle_confirm_dialog(self, accept: bool = True) -> 'PracticePage':
        """å¤„ç†ç¡®è®¤å¯¹è¯æ¡†"""
        self.page.on("dialog", lambda dialog: dialog.accept() if accept else dialog.dismiss())
        return self
```

### 3. æ•°æ®é©±åŠ¨æµ‹è¯•ç¤ºä¾‹

```python
import pytest
import json
from pathlib import Path

# ä»JSONæ–‡ä»¶åŠ è½½æµ‹è¯•æ•°æ®
def load_test_data(filename: str) -> dict:
    """ä»JSONæ–‡ä»¶åŠ è½½æµ‹è¯•æ•°æ®"""
    data_file = Path("tests/data") / filename
    with open(data_file, 'r', encoding='utf-8') as f:
        return json.load(f)

# å‚æ•°åŒ–æµ‹è¯•
class TestDataDriven:
    """æ•°æ®é©±åŠ¨æµ‹è¯•ç¤ºä¾‹"""
    
    @pytest.mark.parametrize("user_data,expected_result", [
        ({"username": "valid_user", "password": "Valid123!"}, True),
        ({"username": "invalid_user", "password": "wrong"}, False),
        ({"username": "", "password": "Valid123!"}, False),
        ({"username": "valid_user", "password": ""}, False),
    ])
    def test_login_scenarios(self, page, user_data, expected_result):
        """å‚æ•°åŒ–ç™»å½•æµ‹è¯•"""
        login_page = LoginPage(page)
        login_page.navigate()
        
        result = login_page.login(
            user_data["username"], 
            user_data["password"]
        )
        
        assert result == expected_result
    
    @pytest.mark.parametrize("test_case", load_test_data("form_validation_cases.json"))
    def test_form_validation_cases(self, page, test_case):
        """è¡¨å•éªŒè¯æµ‹è¯•ç”¨ä¾‹"""
        practice_page = PracticePage(page)
        practice_page.navigate()
        
        # å¡«å†™è¡¨å•æ•°æ®
        for field, value in test_case["input_data"].items():
            practice_page.fill(f"[data-testid='{field}-input']", value)
        
        practice_page.submit_form()
        
        # éªŒè¯æœŸæœ›ç»“æœ
        if test_case["expected_result"]["valid"]:
            assert practice_page.is_form_submitted_successfully()
        else:
            assert practice_page.has_validation_errors()
            for field, error_msg in test_case["expected_result"]["errors"].items():
                assert error_msg in practice_page.get_validation_error(field)
```

### 4. API å’Œ UI ç»“åˆæµ‹è¯•

```python
import requests
from pages.user_profile_page import UserProfilePage

class TestAPIUIIntegration:
    """API å’Œ UI é›†æˆæµ‹è¯•"""
    
    def test_user_profile_sync(self, page, api_client):
        """æµ‹è¯•ç”¨æˆ·èµ„æ–™åœ¨APIå’ŒUIä¹‹é—´çš„åŒæ­¥"""
        # é€šè¿‡APIåˆ›å»ºç”¨æˆ·
        user_data = {
            "username": "testuser",
            "email": "test@example.com",
            "profile": {
                "name": "Test User",
                "bio": "This is a test user"
            }
        }
        
        api_response = api_client.create_user(user_data)
        assert api_response.status_code == 201
        user_id = api_response.json()["id"]
        
        # åœ¨UIä¸­éªŒè¯ç”¨æˆ·èµ„æ–™
        profile_page = UserProfilePage(page)
        profile_page.navigate(f"/users/{user_id}")
        
        assert profile_page.get_username() == user_data["username"]
        assert profile_page.get_email() == user_data["email"]
        assert profile_page.get_bio() == user_data["profile"]["bio"]
        
        # é€šè¿‡UIæ›´æ–°ç”¨æˆ·èµ„æ–™
        new_bio = "Updated bio through UI"
        profile_page.update_bio(new_bio)
        profile_page.save_changes()
        
        # é€šè¿‡APIéªŒè¯æ›´æ–°
        updated_user = api_client.get_user(user_id)
        assert updated_user.json()["profile"]["bio"] == new_bio
```

## â“ å¸¸è§é—®é¢˜è§£ç­”

### 1. å®‰è£…å’Œç¯å¢ƒé—®é¢˜

**Q: å®‰è£… Playwright æ—¶å‡ºç°ç½‘ç»œé”™è¯¯æ€ä¹ˆåŠï¼Ÿ**

A: å¯ä»¥å°è¯•ä»¥ä¸‹è§£å†³æ–¹æ¡ˆï¼š
```bash
# ä½¿ç”¨å›½å†…é•œåƒ
export PLAYWRIGHT_DOWNLOAD_HOST=https://npmmirror.com/mirrors/playwright/
playwright install

# æˆ–è€…æ‰‹åŠ¨ä¸‹è½½æµè§ˆå™¨
playwright install chromium --with-deps
```

**Q: åœ¨ Linux ç³»ç»Ÿä¸Šè¿è¡Œæµ‹è¯•æ—¶å‡ºç°ä¾èµ–é”™è¯¯ï¼Ÿ**

A: å®‰è£…ç³»ç»Ÿä¾èµ–ï¼š
```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install -y libnss3 libatk-bridge2.0-0 libdrm2 libxkbcommon0 libxcomposite1 libxdamage1 libxrandr2 libgbm1 libxss1 libasound2

# æˆ–è€…ä½¿ç”¨ Playwright å‘½ä»¤
playwright install-deps
```

**Q: Docker ç¯å¢ƒä¸­å¦‚ä½•è¿è¡Œæµ‹è¯•ï¼Ÿ**

A: ä½¿ç”¨æä¾›çš„ Dockerfileï¼š
```bash
# æ„å»ºé•œåƒ
docker build -t playwright-tests .

# è¿è¡Œæµ‹è¯•
docker run --rm -v $(pwd)/reports:/app/reports playwright-tests
```

### 2. æµ‹è¯•æ‰§è¡Œé—®é¢˜

**Q: æµ‹è¯•è¿è¡Œå¾ˆæ…¢ï¼Œå¦‚ä½•ä¼˜åŒ–ï¼Ÿ**

A: ä¼˜åŒ–å»ºè®®ï¼š
```python
# 1. ä½¿ç”¨å¹¶è¡Œæ‰§è¡Œ
pytest -n auto

# 2. å¯ç”¨æ— å¤´æ¨¡å¼
# åœ¨ env_config.py ä¸­è®¾ç½® headless=True

# 3. å‡å°‘ç­‰å¾…æ—¶é—´
# åœ¨é¡µé¢å¯¹è±¡ä¸­åˆç†è®¾ç½®è¶…æ—¶æ—¶é—´
self.timeout = 5000  # 5ç§’è€Œä¸æ˜¯é»˜è®¤çš„10ç§’

# 4. ä½¿ç”¨æ›´å¿«çš„ç­‰å¾…ç­–ç•¥
page.goto(url, wait_until="domcontentloaded")  # è€Œä¸æ˜¯ "networkidle"
```

**Q: æµ‹è¯•åœ¨ CI ç¯å¢ƒä¸­ä¸ç¨³å®šæ€ä¹ˆåŠï¼Ÿ**

A: ç¨³å®šæ€§ä¼˜åŒ–ï¼š
```python
# 1. å¢åŠ é‡è¯•æ¬¡æ•°
# pytest.ini ä¸­è®¾ç½®
--reruns=3
--reruns-delay=2

# 2. ä½¿ç”¨æ›´å¯é çš„ç­‰å¾…
from playwright.sync_api import expect
expect(page.locator("#element")).to_be_visible(timeout=30000)

# 3. æ·»åŠ æ˜¾å¼ç­‰å¾…
page.wait_for_load_state("networkidle")
page.wait_for_timeout(1000)  # å¿…è¦æ—¶æ·»åŠ å›ºå®šç­‰å¾…
```

**Q: å¦‚ä½•è°ƒè¯•å¤±è´¥çš„æµ‹è¯•ï¼Ÿ**

A: è°ƒè¯•æ–¹æ³•ï¼š
```python
# 1. å¯ç”¨è°ƒè¯•æ¨¡å¼
pytest --headed --slowmo=1000 tests/test_example.py

# 2. ä½¿ç”¨ page.pause() æš‚åœæ‰§è¡Œ
def test_debug_example(page):
    page.goto("https://example.com")
    page.pause()  # ä¼šæ‰“å¼€æµè§ˆå™¨è°ƒè¯•å™¨
    page.click("#button")

# 3. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
pytest --log-cli-level=DEBUG

# 4. ç”Ÿæˆè·Ÿè¸ªæ–‡ä»¶
pytest --tracing=on
```

### 3. é¡µé¢å¯¹è±¡å’Œå…ƒç´ å®šä½é—®é¢˜

**Q: å…ƒç´ å®šä½ä¸ç¨³å®šï¼Œç»å¸¸æ‰¾ä¸åˆ°å…ƒç´ ï¼Ÿ**

A: å®šä½ç­–ç•¥ä¼˜åŒ–ï¼š
```python
# 1. ä½¿ç”¨æ›´ç¨³å®šçš„å®šä½å™¨
# ä¼˜å…ˆçº§ï¼šdata-testid > id > class > xpath
page.locator("[data-testid='submit-button']")  # æ¨è
page.locator("#submit-btn")                    # å…¶æ¬¡
page.locator(".btn-submit")                    # å†æ¬¡
page.locator("//button[text()='æäº¤']")         # æœ€å

# 2. ä½¿ç”¨ç»„åˆå®šä½å™¨
page.locator("form").locator("[data-testid='username']")  # æ›´ç²¾ç¡®

# 3. ç­‰å¾…å…ƒç´ çŠ¶æ€
page.locator("#element").wait_for(state="visible")
page.locator("#element").wait_for(state="attached")
```

**Q: å¦‚ä½•å¤„ç†åŠ¨æ€å†…å®¹å’Œå¼‚æ­¥åŠ è½½ï¼Ÿ**

A: åŠ¨æ€å†…å®¹å¤„ç†ï¼š
```python
# 1. ç­‰å¾…ç‰¹å®šå†…å®¹å‡ºç°
expect(page.locator("#dynamic-content")).to_contain_text("åŠ è½½å®Œæˆ")

# 2. ç­‰å¾…ç½‘ç»œè¯·æ±‚å®Œæˆ
with page.expect_response(lambda response: "api/data" in response.url) as response_info:
    page.click("#load-data")
response = response_info.value
assert response.status == 200

# 3. ç­‰å¾…å…ƒç´ æ•°é‡ç¨³å®š
expect(page.locator(".list-item")).to_have_count(10)
```

### 4. æŠ¥å‘Šå’Œæ—¥å¿—é—®é¢˜

**Q: Allure æŠ¥å‘Šæ²¡æœ‰ç”Ÿæˆæˆ–æ˜¾ç¤ºä¸å®Œæ•´ï¼Ÿ**

A: æŠ¥å‘Šé—®é¢˜æ’æŸ¥ï¼š
```bash
# 1. ç¡®ä¿æ­£ç¡®ç”Ÿæˆç»“æœæ–‡ä»¶ï¼ˆä½¿ç”¨ä¼šè¯ç›®å½•ï¼‰
pytest --alluredir=reports/test_session_$(date +%Y%m%d_%H%M%S)/allure-results --clean-alluredir

# 2. æ£€æŸ¥ç»“æœæ–‡ä»¶
ls -la reports/test_session_*/allure-results/

# 3. ç”ŸæˆæŠ¥å‘Š
allure generate reports/test_session_*/allure-results -o reports/test_session_*/allure-report --clean

# 4. å¯åŠ¨æŠ¥å‘ŠæœåŠ¡
allure serve reports/test_session_*/allure-results
```

**Q: reportsç›®å½•ä¸‹å‡ºç°ç©ºçš„screenshotså’Œvideosæ–‡ä»¶å¤¹ï¼Ÿ**

A: è¿™ä¸ªé—®é¢˜å·²åœ¨æœ€æ–°ç‰ˆæœ¬ä¸­å®Œå…¨ä¿®å¤ï¼š
```python
# âœ… å·²ä¿®å¤ï¼šHelperç±»ç°åœ¨ä½¿ç”¨æ™ºèƒ½ç›®å½•ç®¡ç†
# - åªåœ¨å®é™…éœ€è¦æ—¶åˆ›å»ºç›®å½•
# - åŸºäºæµ‹è¯•ä¼šè¯éš”ç¦»æ–‡ä»¶
# - é¿å…åˆ›å»ºç©ºç›®å½•

# å½“å‰ç‰ˆæœ¬ç‰¹æ€§ï¼š
# 1. æˆªå›¾å’Œè§†é¢‘æ–‡ä»¶æŒ‰ä¼šè¯ç»„ç»‡ï¼šreports/test_session_YYYYMMDD_HHMMSS/
# 2. åªæœ‰åœ¨å®é™…æˆªå›¾/å½•å±æ—¶æ‰åˆ›å»ºå¯¹åº”ç›®å½•
# 3. è‡ªåŠ¨æ¸…ç†æœºåˆ¶ï¼Œé¿å…ç£ç›˜ç©ºé—´æµªè´¹

# å¦‚æœä½¿ç”¨æ—§ç‰ˆæœ¬ï¼Œè¯·æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
```

**Q: å¦‚ä½•åœ¨æŠ¥å‘Šä¸­æ·»åŠ æ›´å¤šä¿¡æ¯ï¼Ÿ**

A: æŠ¥å‘Šå¢å¼ºï¼š
```python
import allure

@allure.feature("ç”¨æˆ·ç®¡ç†")
@allure.story("ç”¨æˆ·ç™»å½•")
@allure.severity(allure.severity_level.CRITICAL)
def test_user_login(page):
    with allure.step("æ‰“å¼€ç™»å½•é¡µé¢"):
        page.goto("/login")
        allure.attach(page.screenshot(), name="ç™»å½•é¡µé¢", attachment_type=allure.attachment_type.PNG)
    
    with allure.step("è¾“å…¥ç”¨æˆ·å‡­æ®"):
        page.fill("#username", "testuser")
        page.fill("#password", "password")
        allure.attach("testuser", name="ç”¨æˆ·å", attachment_type=allure.attachment_type.TEXT)
    
    with allure.step("ç‚¹å‡»ç™»å½•æŒ‰é’®"):
        page.click("#login-btn")
        page.wait_for_url("**/dashboard")
        allure.attach(page.url, name="ç™»å½•åURL", attachment_type=allure.attachment_type.TEXT)
```

### 5. æ€§èƒ½å’Œèµ„æºé—®é¢˜

**Q: æµ‹è¯•è¿è¡Œæ—¶å†…å­˜å ç”¨è¿‡é«˜ï¼Ÿ**

A: å†…å­˜ä¼˜åŒ–ï¼š
```python
# 1. åŠæ—¶å…³é—­é¡µé¢å’Œä¸Šä¸‹æ–‡
@pytest.fixture
def page(context):
    page = context.new_page()
    yield page
    page.close()  # ç¡®ä¿å…³é—­é¡µé¢

# 2. é™åˆ¶å¹¶è¡Œè¿›ç¨‹æ•°
pytest -n 4  # è€Œä¸æ˜¯ -n auto

# 3. ç¦ç”¨ä¸å¿…è¦çš„åŠŸèƒ½
# åœ¨ä¸éœ€è¦æ—¶ç¦ç”¨è§†é¢‘å½•åˆ¶
context = browser.new_context(record_video_dir=None)
```

**Q: reportsç›®å½•å ç”¨ç£ç›˜ç©ºé—´è¿‡å¤§ï¼Ÿ**

A: ç£ç›˜ç©ºé—´ç®¡ç†ï¼š
```bash
# 1. æ¸…ç†æ—§çš„æµ‹è¯•ä¼šè¯
find reports/ -name "test_session_*" -mtime +7 -exec rm -rf {} \;

# 2. é…ç½®è‡ªåŠ¨æ¸…ç†ï¼ˆåœ¨conftest.pyä¸­ï¼‰
# ä¿ç•™æœ€è¿‘Nä¸ªä¼šè¯ï¼Œåˆ é™¤æ›´æ—©çš„
max_sessions = 10
sessions = sorted(glob.glob("reports/test_session_*"))
if len(sessions) > max_sessions:
    for old_session in sessions[:-max_sessions]:
        shutil.rmtree(old_session)

# 3. å‹ç¼©å†å²æŠ¥å‘Š
tar -czf reports_archive_$(date +%Y%m%d).tar.gz reports/test_session_*
```

**Q: å¦‚ä½•ç›‘æ§æµ‹è¯•æ‰§è¡Œæ€§èƒ½ï¼Ÿ**

A: æ€§èƒ½ç›‘æ§ï¼š
```python
import time
from utils.logger_config import logger_config

def test_with_performance_monitoring(page):
    start_time = time.time()
    
    # æ‰§è¡Œæµ‹è¯•æ“ä½œ
    page.goto("https://example.com")
    page.click("#button")
    
    end_time = time.time()
    duration = end_time - start_time
    
    # è®°å½•æ€§èƒ½æ•°æ®
    logger_config.log_performance("é¡µé¢åŠ è½½å’Œç‚¹å‡»", duration, threshold=5.0)
    
    # æ€§èƒ½æ–­è¨€
    assert duration < 10.0, f"æ“ä½œè€—æ—¶è¿‡é•¿: {duration:.2f}ç§’"
```

## ğŸ¯ æœ€ä½³å®è·µ

### ğŸ† æ¡†æ¶éªŒè¯æ€»ç»“

åŸºäº30ä¸ªæµ‹è¯•ç”¨ä¾‹100%é€šè¿‡çš„éªŒè¯ç»“æœï¼Œä»¥ä¸‹æ˜¯ç»è¿‡å®æˆ˜éªŒè¯çš„æœ€ä½³å®è·µï¼š

**âœ… å·²éªŒè¯çš„æ ¸å¿ƒå®è·µ**
- **é¡µé¢å¯¹è±¡æ¨¡å‹**: ä½¿ç”¨æ ‡å‡†POMæ¨¡å¼ï¼Œæé«˜ä»£ç å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§
- **æ™ºèƒ½ç­‰å¾…ç­–ç•¥**: ä½¿ç”¨Playwrightçš„è‡ªåŠ¨ç­‰å¾…æœºåˆ¶ï¼Œé¿å…ç¡¬ç¼–ç å»¶æ—¶
- **ä¼šè¯éš”ç¦»**: æŒ‰æµ‹è¯•ä¼šè¯ç»„ç»‡è¾“å‡ºæ–‡ä»¶ï¼Œé¿å…æ–‡ä»¶å†²çª
- **å¹¶è¡Œæ‰§è¡Œ**: 16ä¸ªworkerå¹¶è¡Œæ‰§è¡Œï¼Œå¹³å‡1.3ç§’/ç”¨ä¾‹çš„é«˜æ•ˆæ€§èƒ½
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸æ•è·å’Œè°ƒè¯•ä¿¡æ¯è¾“å‡º

**ğŸ¯ æ¨èçš„æµ‹è¯•ç­–ç•¥**
- ä¼˜å…ˆæµ‹è¯•æ ¸å¿ƒä¸šåŠ¡æµç¨‹ï¼ˆå¦‚è¡¨å•æäº¤ã€ç”¨æˆ·äº¤äº’ï¼‰
- ä½¿ç”¨æ•°æ®é©±åŠ¨æµ‹è¯•è¦†ç›–å¤šç§åœºæ™¯
- ä¿æŒæµ‹è¯•ç”¨ä¾‹çš„ç‹¬ç«‹æ€§å’ŒåŸå­æ€§
- åˆç†ä½¿ç”¨æµ‹è¯•æ ‡è®°è¿›è¡Œåˆ†ç±»æ‰§è¡Œ

### 1. ä»£ç ç»„ç»‡æœ€ä½³å®è·µ

#### æ¨¡å—åŒ–è®¾è®¡
```python
# å°†å¤æ‚çš„é¡µé¢æ‹†åˆ†ä¸ºå¤šä¸ªç»„ä»¶
class HeaderComponent(BasePage):
    """é¡µé¢å¤´éƒ¨ç»„ä»¶"""
    
    def __init__(self, page: Page):
        super().__init__(page)
        self.container = page.locator(".header")
    
    def search(self, keyword: str):
        self.container.locator("#search-input").fill(keyword)
        self.container.locator("#search-btn").click()
        return self

class NavigationComponent(BasePage):
    """å¯¼èˆªç»„ä»¶"""
    
    def navigate_to_section(self, section: str):
        self.page.locator(f"[data-nav='{section}']").click()
        return self

class HomePage(BasePage):
    """é¦–é¡µï¼Œç»„åˆå¤šä¸ªç»„ä»¶"""
    
    def __init__(self, page: Page):
        super().__init__(page)
        self.header = HeaderComponent(page)
        self.navigation = NavigationComponent(page)
```

#### æ™ºèƒ½ç›®å½•ç®¡ç†
```python
# åˆ©ç”¨ä¼šè¯éš”ç¦»æœºåˆ¶ç»„ç»‡æµ‹è¯•è¾“å‡º
class TestSessionManager:
    """æµ‹è¯•ä¼šè¯ç®¡ç†å™¨"""
    
    @staticmethod
    def get_session_dir() -> str:
        """è·å–å½“å‰æµ‹è¯•ä¼šè¯ç›®å½•"""
        session_dir = os.getenv('PYTEST_SESSION_DIR')
        if not session_dir:
            timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
            session_dir = f"reports/test_session_{timestamp}"
            os.environ['PYTEST_SESSION_DIR'] = session_dir
        return session_dir
    
    @staticmethod
    def cleanup_old_sessions(max_sessions: int = 10):
        """æ¸…ç†æ—§çš„æµ‹è¯•ä¼šè¯"""
        sessions = sorted(glob.glob("reports/test_session_*"))
        if len(sessions) > max_sessions:
            for old_session in sessions[:-max_sessions]:
                shutil.rmtree(old_session, ignore_errors=True)

# åœ¨Helperç±»ä¸­ä½¿ç”¨ä¼šè¯ç›®å½•
class ScreenshotHelper:
    def __init__(self, session_dir: str = None):
        self.session_dir = session_dir or TestSessionManager.get_session_dir()
        self.screenshot_dir = os.path.join(self.session_dir, "screenshots")
        os.makedirs(self.screenshot_dir, exist_ok=True)
```

#### é…ç½®ç®¡ç†
```python
# ä½¿ç”¨ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶
import os
from pathlib import Path

class TestConfig:
    """æµ‹è¯•é…ç½®ç®¡ç†"""
    
    def __init__(self):
        self.base_dir = Path(__file__).parent
        self.env = os.getenv("TEST_ENV", "test")
        self.config = self._load_config()
    
    def _load_config(self) -> dict:
         """åŠ è½½é…ç½®æ–‡ä»¶"""
         config_file = self.base_dir / "config" / f"{self.env}.json"
         if config_file.exists():
             with open(config_file, 'r', encoding='utf-8') as f:
                 return json.load(f)
         return self._get_default_config()
     
     def _get_default_config(self) -> dict:
         """è·å–é»˜è®¤é…ç½®"""
         return {
            "timeout": 30000,
            "headless": True
        }
```

#### æ•°æ®ç®¡ç†
```python
# ä½¿ç”¨æ•°æ®ç±»ç®¡ç†æµ‹è¯•æ•°æ®
from dataclasses import dataclass
from typing import Optional

@dataclass
class UserData:
    """ç”¨æˆ·æ•°æ®æ¨¡å‹"""
    username: str
    password: str
    email: Optional[str] = None
    full_name: Optional[str] = None
    
    def is_valid(self) -> bool:
        """éªŒè¯ç”¨æˆ·æ•°æ®æ˜¯å¦æœ‰æ•ˆ"""
        return bool(self.username and self.password)

@dataclass
class TestEnvironment:
    """æµ‹è¯•ç¯å¢ƒæ•°æ®æ¨¡å‹"""
    name: str
    database_url: Optional[str] = None
```

### 2. æµ‹è¯•è®¾è®¡æœ€ä½³å®è·µ

#### æµ‹è¯•é‡‘å­—å¡”åŸåˆ™
```python
# 1. å•å…ƒæµ‹è¯• (70%) - å¿«é€Ÿã€ç¨³å®šã€éš”ç¦»
class TestFormValidation:
    """è¡¨å•éªŒè¯å•å…ƒæµ‹è¯•"""
    
    def test_email_validation(self):
        """æµ‹è¯•é‚®ç®±æ ¼å¼éªŒè¯"""
        validator = EmailValidator()
        assert validator.is_valid("test@example.com")
        assert not validator.is_valid("invalid-email")

# 2. é›†æˆæµ‹è¯• (20%) - æµ‹è¯•ç»„ä»¶é—´äº¤äº’
class TestUserRegistrationFlow:
    """ç”¨æˆ·æ³¨å†Œæµç¨‹é›†æˆæµ‹è¯•"""
    
    def test_complete_registration_flow(self, page, api_client):
        """æµ‹è¯•å®Œæ•´æ³¨å†Œæµç¨‹"""
        # UIæ“ä½œ
        registration_page = RegistrationPage(page)
        registration_page.fill_registration_form(user_data)
        
        # APIéªŒè¯
        user = api_client.get_user_by_email(user_data.email)
        assert user.status == "pending_verification"

# 3. E2Eæµ‹è¯• (10%) - å®Œæ•´ä¸šåŠ¡æµç¨‹
class TestCompleteUserJourney:
    """å®Œæ•´ç”¨æˆ·æ—…ç¨‹E2Eæµ‹è¯•"""
    
    @pytest.mark.e2e
    def test_user_complete_journey(self, page):
        """æµ‹è¯•ç”¨æˆ·å®Œæ•´ä½¿ç”¨æ—…ç¨‹"""
        # æ³¨å†Œ -> ç™»å½• -> ä½¿ç”¨åŠŸèƒ½ -> é€€å‡º
        pass
```

#### æµ‹è¯•æ•°æ®ç­–ç•¥
```python
# 1. æµ‹è¯•æ•°æ®å·¥å‚
class UserDataFactory:
    """ç”¨æˆ·æ•°æ®å·¥å‚"""
    
    @staticmethod
    def create_valid_user() -> UserData:
        """åˆ›å»ºæœ‰æ•ˆç”¨æˆ·æ•°æ®"""
        fake = Faker('zh_CN')
        return UserData(
            username=fake.user_name(),
            password="Test123!",
            email=fake.email(),
            full_name=fake.name()
        )
    
    @staticmethod
    def create_invalid_user() -> UserData:
        """åˆ›å»ºæ— æ•ˆç”¨æˆ·æ•°æ®"""
        return UserData(username="", password="")

# 2. æµ‹è¯•æ•°æ®æ¸…ç†
@pytest.fixture(autouse=True)
def cleanup_test_data(request):
    """è‡ªåŠ¨æ¸…ç†æµ‹è¯•æ•°æ®"""
    yield
    # æµ‹è¯•å®Œæˆåæ¸…ç†æ•°æ®
    if hasattr(request.node, 'test_data_ids'):
        cleanup_users(request.node.test_data_ids)
```

### 3. é¡µé¢å¯¹è±¡è®¾è®¡æœ€ä½³å®è·µ

#### ç»„ä»¶åŒ–é¡µé¢å¯¹è±¡
```python
# åŸºç¡€ç»„ä»¶
class BaseComponent:
    """åŸºç¡€ç»„ä»¶ç±»"""
    
    def __init__(self, page: Page, container_selector: str):
        self.page = page
        self.container = page.locator(container_selector)
    
    def is_visible(self) -> bool:
        return self.container.is_visible()

# å…·ä½“ç»„ä»¶å®ç°
class SearchComponent(BaseComponent):
    """æœç´¢ç»„ä»¶"""
    
    def __init__(self, page: Page):
        super().__init__(page, "[data-component='search']")
    
    def search(self, keyword: str) -> 'SearchComponent':
        self.container.locator("input[type='search']").fill(keyword)
        self.container.locator("button[type='submit']").click()
        return self
    
    def get_results_count(self) -> int:
        return self.container.locator(".search-result").count()

# é¡µé¢ç»„åˆç»„ä»¶
class HomePage(BasePage):
    """é¦–é¡µï¼Œç»„åˆå¤šä¸ªç»„ä»¶"""
    
    def __init__(self, page: Page):
        super().__init__(page)
        self.search = SearchComponent(page)
        self.navigation = NavigationComponent(page)
        self.header = HeaderComponent(page)
```

#### æ™ºèƒ½ç­‰å¾…ç­–ç•¥
```python
class SmartWaitMixin:
    """æ™ºèƒ½ç­‰å¾…æ··å…¥ç±»"""
    
    def wait_for_ajax_complete(self, timeout: int = 30000) -> None:
        """ç­‰å¾…AJAXè¯·æ±‚å®Œæˆ"""
        self.page.wait_for_function(
            "() => window.jQuery && jQuery.active === 0",
            timeout=timeout
        )
    
    def wait_for_loading_complete(self, timeout: int = 30000) -> None:
        """ç­‰å¾…åŠ è½½å®Œæˆ"""
        # ç­‰å¾…åŠ è½½æŒ‡ç¤ºå™¨æ¶ˆå¤±
        self.page.wait_for_selector(".loading", state="hidden", timeout=timeout)
    
    def wait_for_element_stable(self, selector: str, timeout: int = 10000) -> None:
        """ç­‰å¾…å…ƒç´ ä½ç½®ç¨³å®š"""
        element = self.page.locator(selector)
        previous_box = None
        
        for _ in range(10):  # æœ€å¤šæ£€æŸ¥10æ¬¡
            current_box = element.bounding_box()
            if previous_box and previous_box == current_box:
                return  # ä½ç½®ç¨³å®š
            previous_box = current_box
            self.page.wait_for_timeout(100)
        
        raise TimeoutError(f"å…ƒç´  {selector} ä½ç½®æœªç¨³å®š")
```

### 4. æµ‹è¯•æ‰§è¡Œæœ€ä½³å®è·µ

#### å¹¶è¡Œæ‰§è¡Œä¼˜åŒ–
```python
# pytest.ini é…ç½®
[pytest]
# å¹¶è¡Œæ‰§è¡Œé…ç½®
addopts = 
    -n auto                    # è‡ªåŠ¨æ£€æµ‹CPUæ ¸å¿ƒæ•°
    --dist=worksteal          # å·¥ä½œçªƒå–ç®—æ³•
    --maxfail=5               # æœ€å¤šå¤±è´¥5ä¸ªå°±åœæ­¢
    --tb=short                # ç®€çŸ­é”™è¯¯ä¿¡æ¯

# æµ‹è¯•åˆ†ç»„
markers =
    parallel: å¯ä»¥å¹¶è¡Œæ‰§è¡Œçš„æµ‹è¯•
    serial: å¿…é¡»ä¸²è¡Œæ‰§è¡Œçš„æµ‹è¯•
    database: éœ€è¦æ•°æ®åº“çš„æµ‹è¯•
```

#### æµ‹è¯•éš”ç¦»ç­–ç•¥
```python
# 1. æ•°æ®éš”ç¦»
@pytest.fixture(scope="function")
def isolated_user(api_client):
    """ä¸ºæ¯ä¸ªæµ‹è¯•åˆ›å»ºç‹¬ç«‹ç”¨æˆ·"""
    user = api_client.create_user(UserDataFactory.create_valid_user())
    yield user
    api_client.delete_user(user.id)  # æµ‹è¯•åæ¸…ç†

# 2. æµè§ˆå™¨éš”ç¦»
@pytest.fixture(scope="function")
def clean_browser_context(browser):
    """ä¸ºæ¯ä¸ªæµ‹è¯•åˆ›å»ºå¹²å‡€çš„æµè§ˆå™¨ä¸Šä¸‹æ–‡"""
    context = browser.new_context(
        viewport={"width": 1920, "height": 1080},
        locale="zh-CN",
        timezone_id="Asia/Shanghai"
    )
    yield context
    context.close()
```

### 5. é”™è¯¯å¤„ç†å’Œè°ƒè¯•æœ€ä½³å®è·µ

#### æ™ºèƒ½é”™è¯¯æ¢å¤
```python
class ErrorRecoveryMixin:
    """é”™è¯¯æ¢å¤æ··å…¥ç±»"""
    
    def retry_on_stale_element(self, action_func, max_retries: int = 3):
        """åœ¨å…ƒç´ è¿‡æœŸæ—¶é‡è¯•æ“ä½œ"""
        for attempt in range(max_retries):
            try:
                return action_func()
            except Exception as e:
                if "stale element" in str(e).lower() and attempt < max_retries - 1:
                    self.page.wait_for_timeout(1000)  # ç­‰å¾…1ç§’åé‡è¯•
                    continue
                raise
    
    def handle_unexpected_popup(self, action_func):
        """å¤„ç†æ„å¤–å¼¹çª—"""
        def popup_handler(dialog):
            logger.warning(f"å¤„ç†æ„å¤–å¼¹çª—: {dialog.message}")
            dialog.accept()
        
        self.page.on("dialog", popup_handler)
        try:
            return action_func()
        finally:
            self.page.remove_listener("dialog", popup_handler)
```

#### è¯¦ç»†é”™è¯¯æŠ¥å‘Š
```python
class DetailedErrorReporting:
    """è¯¦ç»†é”™è¯¯æŠ¥å‘Š"""
    
    @staticmethod
    def capture_failure_context(page: Page, test_name: str) -> dict:
        """æ•è·å¤±è´¥æ—¶çš„ä¸Šä¸‹æ–‡ä¿¡æ¯"""
        context = {
            "timestamp": datetime.now().isoformat(),
            "test_name": test_name,
            "url": page.url,
            "title": page.title(),
            "viewport": page.viewport_size,
            "user_agent": page.evaluate("navigator.userAgent"),
            "local_storage": page.evaluate("JSON.stringify(localStorage)"),
            "session_storage": page.evaluate("JSON.stringify(sessionStorage)"),
            "cookies": page.context.cookies(),
            "console_logs": [],  # éœ€è¦åœ¨æµ‹è¯•å¼€å§‹æ—¶æ”¶é›†
            "network_logs": []   # éœ€è¦åœ¨æµ‹è¯•å¼€å§‹æ—¶æ”¶é›†
        }
        
        # æˆªå›¾
        screenshot_path = f"reports/screenshots/{test_name}_{int(time.time())}.png"
        page.screenshot(path=screenshot_path, full_page=True)
        context["screenshot"] = screenshot_path
        
        return context
```

### 6. æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ

#### èµ„æºç®¡ç†
```python
class ResourceManager:
    """èµ„æºç®¡ç†å™¨"""
    
    def __init__(self):
        self.browsers = []
        self.contexts = []
        self.pages = []
    
    def create_browser(self, **kwargs):
        """åˆ›å»ºæµè§ˆå™¨å®ä¾‹"""
        browser = playwright.chromium.launch(**kwargs)
        self.browsers.append(browser)
        return browser
    
    def cleanup_all(self):
        """æ¸…ç†æ‰€æœ‰èµ„æº"""
        for page in self.pages:
            try:
                page.close()
            except Exception:
                pass
        
        for context in self.contexts:
            try:
                context.close()
            except Exception:
                pass
        
        for browser in self.browsers:
            try:
                browser.close()
            except Exception:
                pass
```

#### ç¼“å­˜ç­–ç•¥
```python
class TestDataCache:
    """æµ‹è¯•æ•°æ®ç¼“å­˜"""
    
    def __init__(self):
        self._cache = {}
        self._cache_timeout = 300  # 5åˆ†é’Ÿ
    
    def get_or_create_user(self, user_type: str, api_client):
        """è·å–æˆ–åˆ›å»ºç”¨æˆ·æ•°æ®"""
        cache_key = f"user_{user_type}"
        
        if cache_key in self._cache:
            cached_data, timestamp = self._cache[cache_key]
            if time.time() - timestamp < self._cache_timeout:
                return cached_data
        
        # åˆ›å»ºæ–°ç”¨æˆ·
        user_data = UserDataFactory.create_user_by_type(user_type)
        user = api_client.create_user(user_data)
        
        self._cache[cache_key] = (user, time.time())
        return user
```

### 7. CI/CD é›†æˆæœ€ä½³å®è·µ

#### GitHub Actions é…ç½®
```yaml
# .github/workflows/test.yml
name: è‡ªåŠ¨åŒ–æµ‹è¯•

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  schedule:
    - cron: '0 2 * * *'  # æ¯å¤©å‡Œæ™¨2ç‚¹è¿è¡Œ

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.9, 3.10, 3.11]
        browser: [chromium, firefox, webkit]
    
    steps:
    - uses: actions/checkout@v3
    
    - name: è®¾ç½® Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
    
    - name: å®‰è£…ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        playwright install ${{ matrix.browser }}
        playwright install-deps
    
    - name: è¿è¡Œæµ‹è¯•
      run: |
        pytest --browser=${{ matrix.browser }} \
               --alluredir=allure-results \
               --html=reports/report.html \
               --maxfail=5 \
               -n auto
      env:
        TEST_ENV: ci
        HEADLESS: true
    
    - name: ä¸Šä¼ æµ‹è¯•æŠ¥å‘Š
      uses: actions/upload-artifact@v3
      if: always()
      with:
        name: test-reports-${{ matrix.browser }}
        path: |
          reports/
          allure-results/
    
    - name: å‘å¸ƒ Allure æŠ¥å‘Š
      uses: simple-elf/allure-report-action@master
      if: always()
      with:
        allure_results: allure-results
        allure_report: allure-report
        gh_pages: gh-pages
```

#### æµ‹è¯•ç¯å¢ƒç®¡ç†
```python
# ç¯å¢ƒç‰¹å®šé…ç½®
class CIEnvironmentConfig:
    """CIç¯å¢ƒé…ç½®"""
    
    @staticmethod
    def get_ci_config() -> dict:
        return {
            "headless": True,
            "slow_mo": 0,
            "timeout": 60000,  # CIç¯å¢ƒç½‘ç»œå¯èƒ½è¾ƒæ…¢
            "retry_times": 3,
            "parallel_workers": 2,  # CIç¯å¢ƒèµ„æºæœ‰é™
            "video_record": False,  # èŠ‚çœå­˜å‚¨ç©ºé—´
            "screenshot_on_failure": True
        }
```

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

### ä»£ç è§„èŒƒ

- éµå¾ª PEP 8 Python ä»£ç è§„èŒƒ
- ä½¿ç”¨ç±»å‹æç¤º
- ç¼–å†™å®Œæ•´çš„æ–‡æ¡£å­—ç¬¦ä¸²
- ä¿æŒæµ‹è¯•è¦†ç›–ç‡åœ¨ 80% ä»¥ä¸Š

## ğŸ“ æ”¯æŒä¸è”ç³»

å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- ğŸ“§ é‚®ç®±ï¼šsupport@example.com
- ğŸ› é—®é¢˜åé¦ˆï¼š[GitHub Issues](https://github.com/your-repo/issues)
- ğŸ“– æ–‡æ¡£ï¼š[é¡¹ç›®æ–‡æ¡£](https://your-docs-site.com)
- ğŸ’¬ è®¨è®ºï¼š[GitHub Discussions](https://github.com/your-repo/discussions)

---

**æ„Ÿè°¢ä½¿ç”¨ Playwright-Pytest-Allure Web UI è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼** ğŸ‰